@using keyhanPostWeb.GeneralService
@using keyhanPostWeb.GeneralViewModels.RepDto
@model RepApplicantDetailDto

@{
    ViewData["Title"] = "جزییات درخواست نمایندگی";
    Layout = "_adminPanelLayout";
}
<link rel="stylesheet" href="~/css/list.css" />

<div class="applicant-container rtl">

    <h2 class="section-title">مشخصات متقاضی</h2>

    <div class="grid-box">

        <div class="item"><label>کد پیگیری</label><span>@Model.TrackingNumber</span></div>
        <div class="item"><label>نام متقاضی</label><span>@Model.ApplicantName</span></div>
        <div class="item"><label>نام کاربری</label><span>@Model.Username</span></div>
        <div class="item"><label>شماره موبایل</label><span>@Model.MobileNumber</span></div>
        <div class="item"><label>ایمیل</label><span>@Model.Email</span></div>
        <div class="item"><label>شناسه ملی</label><span>@Model.NationalId</span></div>
        <div class="item"><label>تحصیلات</label><span>@Model.EducationDegree</span></div>
        <div class="item"><label>نوع شخصیت</label><span>@Model.EntityType</span></div>
        <div class="item"><label>نحوه آشنایی</label><span>@Model.Introduction</span></div>
        <div class="item"><label>نوع نمایندگی</label><span>@Model.AgencyType</span></div>
        <div class="item"><label>وضعیت درخواست</label><span>@Model.RequestStatus</span></div>
        <div class="item"><label>سابقه فعالیت</label><span>@Model.Experience</span></div>
        <div class="item"><label>وضعیت وسیله نقلیه</label><span>@Model.VehicleAvailability</span></div>
        <div class="item"><label>نوع خودرو</label><span>@Model.VehicleType</span></div>
        <div class="item"><label>شهر</label><span>@Model.CityName</span></div>

        <div class="item wide"><label>آدرس محل نمایندگی</label><span>@Model.BranchAddress</span></div>
        <div class="item wide"><label>سایر توضیحات</label><span>@Model.OtherDesc</span></div>

    </div>
    <button class="btn-change-status" onclick="openStatusModal()">
    تغییر وضعیت درخواست
    </button>
   <div class="modal-overlay" id="statusModal">
    <div class="modal-box rtl">

        <h3 style="margin-bottom: 15px;">تغییر وضعیت درخواست</h3>

        <label>وضعیت جدید</label>
        <select id="NewStatus" class="modal-input">
            <option value="">انتخاب کنید...</option>
            @foreach (var item in (IEnumerable<SelectListItem>)ViewBag.RequestStatus)
            {
                <option value="@item.Value">@item.Text</option>
            }
        </select>

        <label>یادداشت</label>
        <textarea id="EvaluationNote" class="modal-textarea" rows="4"></textarea>

        <div class="modal-actions">
            <button class="btn-save" onclick="saveStatus()">ذخیره</button>
            <button class="btn-cancel" onclick="closeStatusModal()">انصراف</button>
        </div>
    </div>
</div>


</div>
<script>

    function openStatusModal() {
        document.getElementById("statusModal").style.display = "flex";
    }

    function closeStatusModal() {
        document.getElementById("statusModal").style.display = "none";
    }

    function saveStatus() {

    var dto = {
        ApplicantId: "@Model.Id",
        NewStatusId: $("#NewStatus").val(),
        EvaluationNote: $("#EvaluationNote").val().trim()
    };

    if (!dto.NewStatusId) {
        alert("لطفاً وضعیت جدید را انتخاب کنید.");
        return;
    }

    if (dto.EvaluationNote === "") {
        alert("لطفاً یادداشت را وارد کنید.");
        return;
    }

    $.ajax({
        url: '/Job/UpdateRequestStatus',
        type: 'POST',
        data: dto,
        success: function (res) {
            if (res.success) {
                alert(res.message);
                location.reload();
            } else {
                alert(res.message);
            }
        },
        error: function () {
            alert("خطا در ارسال اطلاعات");
        }
    });
    }

</script>



